<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고객센터 - 경산온(ON)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 24px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto p-4 md:p-6">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl md:text-3xl font-bold">
                <i class="fas fa-headset mr-2"></i>고객센터
            </h1>
            <a href="/" class="text-gray-600 hover:text-gray-900">
                <i class="fas fa-home mr-1"></i>메인
            </a>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-sm mb-6">
            <div class="flex border-b">
                <button onclick="showTab('faq')" id="tab-faq" class="flex-1 py-3 px-4 tab-active">
                    <i class="fas fa-question-circle mr-2"></i>FAQ
                </button>
                <button onclick="showTab('inquiry')" id="tab-inquiry" class="flex-1 py-3 px-4 text-gray-600">
                    <i class="fas fa-edit mr-2"></i>1:1 문의
                </button>
                <button onclick="showTab('history')" id="tab-history" class="flex-1 py-3 px-4 text-gray-600">
                    <i class="fas fa-list mr-2"></i>문의 이력
                </button>
            </div>

            <!-- FAQ Tab -->
            <div id="content-faq" class="p-6">
                <div class="space-y-3">
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">배달비가 정말 0원인가요?</summary>
                        <p class="mt-2 text-sm text-gray-600">네, 경산시 보조금 지원으로 배달비가 무료입니다.</p>
                    </details>
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">전통시장 여러 가게 동시 주문이 가능한가요?</summary>
                        <p class="mt-2 text-sm text-gray-600">네, 여러 가게 상품을 장바구니에 담아 한번에 주문할 수 있습니다.</p>
                    </details>
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">안전거래 장소는 어디에 있나요?</summary>
                        <p class="mt-2 text-sm text-gray-600">경찰서, 파출소, CCTV 밀집 지역 등 8곳이 지정되어 있습니다.</p>
                    </details>
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">로컬푸드는 언제 배송되나요?</summary>
                        <p class="mt-2 text-sm text-gray-600">당일 수확 상품은 당일 또는 익일 배송됩니다.</p>
                    </details>
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">가맹점 등록은 어떻게 하나요?</summary>
                        <p class="mt-2 text-sm text-gray-600">사업자등록증 사진 1장으로 3분 등록이 가능합니다. 24시간 내 승인됩니다.</p>
                    </details>
                </div>
            </div>

            <!-- 1:1 Inquiry Tab -->
            <div id="content-inquiry" class="p-6 hidden">
                <form onsubmit="submitInquiry(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">문의 유형 <span class="text-red-500">*</span></label>
                        <select id="inquiry-type" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">선택해주세요</option>
                            <option value="결제">결제</option>
                            <option value="주문">주문</option>
                            <option value="가맹">가맹</option>
                            <option value="오류">오류</option>
                            <option value="기타">기타</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">제목 <span class="text-red-500">*</span></label>
                        <input type="text" id="inquiry-title" required 
                               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="문의 제목을 입력하세요">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">내용 <span class="text-red-500">*</span></label>
                        <textarea id="inquiry-content" required rows="6"
                                  class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                  placeholder="문의 내용을 자세히 입력해주세요"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">연락처 (선택)</label>
                        <input type="tel" id="inquiry-phone" 
                               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="010-0000-0000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">첨부파일 (선택)</label>
                        <input type="file" id="inquiry-file" accept="image/*"
                               class="w-full px-4 py-2 border rounded-lg">
                        <p class="text-xs text-gray-500 mt-1">이미지 파일만 첨부 가능합니다.</p>
                    </div>

                    <button type="submit" class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">
                        <i class="fas fa-paper-plane mr-2"></i>문의 접수
                    </button>
                </form>
            </div>

            <!-- History Tab -->
            <div id="content-history" class="p-6 hidden">
                <div id="history-list">
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>문의 이력이 없습니다.</p>
                        <p class="text-sm mt-2">로그인 후 문의 이력을 확인하실 수 있습니다.</p>
                        <a href="/login" class="inline-block mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            로그인하기
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Info -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="font-bold text-lg mb-4"><i class="fas fa-phone mr-2"></i>전화 문의</h3>
                <p class="text-2xl font-bold text-blue-600 mb-2">1588-0000</p>
                <p class="text-sm text-gray-600">평일 09:00 - 18:00</p>
            </div>
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="font-bold text-lg mb-4"><i class="fas fa-comments mr-2"></i>챗봇 상담</h3>
                <p class="text-sm text-gray-600 mb-3">우측 하단 '온이' 챗봇으로 24시간 상담 가능</p>
                <a href="/static/i18n/chatbot-ko" class="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    <i class="fas fa-comment-dots mr-1"></i>챗봇 열기
                </a>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="text-center">
                <i class="fas fa-check-circle text-5xl text-green-600 mb-4"></i>
                <h3 class="text-xl font-bold mb-2">문의가 접수되었습니다</h3>
                <p class="text-gray-600 mb-2">답변까지 1~2일 소요됩니다.</p>
                <p class="text-sm text-gray-500 mb-6">문의번호: <span id="ticket-number"></span></p>
                <button onclick="closeModal()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    확인
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('[id^="content-"]').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(el => {
                el.classList.remove('tab-active', 'text-blue-600');
                el.classList.add('text-gray-600');
            });

            // Show selected tab
            document.getElementById('content-' + tabName).classList.remove('hidden');
            const tab = document.getElementById('tab-' + tabName);
            tab.classList.add('tab-active', 'text-blue-600');
            tab.classList.remove('text-gray-600');
        }

        async function submitInquiry(event) {
            event.preventDefault();

            const type = document.getElementById('inquiry-type').value;
            const title = document.getElementById('inquiry-title').value;
            const content = document.getElementById('inquiry-content').value;
            const phone = document.getElementById('inquiry-phone').value;

            try {
                const response = await axios.post('/api/support/inquiry', {
                    type,
                    title,
                    content,
                    phone
                });

                // Show success modal
                document.getElementById('ticket-number').textContent = response.data.ticketId;
                document.getElementById('successModal').classList.add('active');

                // Reset form
                event.target.reset();
            } catch (error) {
                console.error('문의 접수 실패:', error);
                alert('문의 접수에 실패했습니다. 다시 시도해주세요.');
            }
        }

        function closeModal() {
            document.getElementById('successModal').classList.remove('active');
            showTab('history');
            loadHistory();
        }

        async function loadHistory() {
            // TODO: Load user's inquiry history
            // For now, show empty state
        }
    </script>
</body>
</html>
